# PhotoWatermark2
AI4SE homework2

## 功能特性

### 图片导入功能
- **单张图片导入**：通过文件对话框选择单张图片
- **批量图片导入**：一次性选择多张图片导入
- **文件夹导入**：导入整个文件夹中的所有图片
- **拖拽导入**：直接将图片文件拖拽到应用程序窗口或图片列表区域

### 图片导出功能
- **单张图片导出**：导出当前选中的图片
- **批量图片导出**：一次性导出所有已导入的图片
- **输出格式选择**：支持JPEG和PNG格式
- **文件命名规则**：自定义前缀和后缀
- **JPEG质量调节**：0-100质量滑块控制
- **图片尺寸调整**：
  - 按宽度缩放（保持宽高比）
  - 按高度缩放（保持宽高比）
  - 按百分比缩放（1%-500%）

### 文本水印功能
- **水印文本设置**：自定义水印文字内容
- **水印位置选择**：支持9种预设位置（左上角、右上角、左下角、右下角、正中心、顶部居中、底部居中、左侧居中、右侧居中）
- **字体和样式**：
  - 字体选择（Arial、Times New Roman、SimHei、Microsoft YaHei、SimSun）
  - 字号调节（10-72px）
  - 粗体/斜体效果
- **颜色设置**：
  - 预设颜色选择（白色、黑色、红色、蓝色、绿色、黄色）
  - 自定义颜色选择器（支持RGB颜色选择）
  - 实时颜色预览
- **透明度调节**：0-100%透明度滑块控制
- **特效选项**：
  - 阴影效果
  - 描边效果
- **水印启用/禁用**：灵活控制水印的添加

### 配置管理功能
- **水印模板管理**：
  - 保存当前水印设置为模板
  - 加载已保存的水印模板
  - 删除不需要的模板
  - 模板列表下拉选择
- **默认模板设置**：
  - 设置默认水印模板
  - 应用默认模板到当前设置
- **自动保存和加载**：
  - 程序关闭时自动保存当前水印设置
  - 程序启动时自动加载上次设置或默认模板
  - 配置文件存储在用户目录下（~/.photowatermark2/）
- **模板文件格式**：使用JSON格式存储，便于备份和迁移

### 实时预览功能
- **即时效果反馈**：所有水印设置变更立即反映在预览窗口中
- **多图片切换预览**：点击左侧图片列表可快速切换预览不同图片
- **水印设置同步更新**：
  - 文本内容变更实时预览
  - 位置选择即时生效
  - 字体、字号、样式调整立即显示
  - 颜色选择实时更新预览效果
  - 透明度调节动态反馈
- **交互式预览体验**：无需手动刷新，所有操作自动更新预览

### 支持的图片格式
- JPEG (.jpg, .jpeg)
- PNG (.png)
- BMP (.bmp)
- TIFF (.tif, .tiff)

### 拖拽功能使用说明
1. **拖拽到窗口**：将图片文件直接拖拽到应用程序窗口的任何位置
2. **拖拽到列表**：将图片文件拖拽到左侧的图片列表区域
3. **视觉反馈**：拖拽时列表区域会显示蓝色虚线边框
4. **格式检查**：自动过滤不支持的图片格式

### 使用方法
1. 运行 `python run.py` 启动应用程序
2. 使用以下任一方式导入图片：
   - 点击"导入单张"、"导入多张"或"导入文件夹"按钮
   - 直接将图片文件拖拽到应用程序窗口
3. 在左侧列表中选择图片进行预览
4. 图片信息将显示在右侧预览区域
5. 配置水印设置（可选）：
   - 启用水印功能
   - 设置水印文本内容
   - 选择水印位置、字体、颜色、透明度等
   - **实时预览**：所有设置变更会立即在预览窗口中显示效果
6. **配置管理功能使用**：
   - **保存模板**：输入模板名称，点击"保存模板"按钮
   - **加载模板**：从下拉列表选择模板，点击"加载模板"按钮
   - **删除模板**：选择模板后点击"删除模板"按钮
   - **设置默认模板**：选择模板后点击"设为默认模板"按钮
   - **应用默认模板**：点击"应用默认模板"按钮
7. 在右侧导出设置区域配置导出选项：
   - 选择输出格式（JPEG/PNG）
   - 设置文件命名规则（前缀/后缀）
   - 调节JPEG质量（0-100）
   - 选择图片缩放方式（宽度/高度/百分比）
   - 点击"导出当前图片"或"导出所有图片"按钮

## 项目结构

```
PhotoWatermark2/
 ├── main.py # 主程序入口
 ├── run.py # 启动脚本
 ├── requirements.txt # 依赖列表
 ├── requirements.md # 需求规格说明
 ├── core/ # 核心功能模块 
 │ ├── image_processor.py # 图像处理 
 │ └── image_manager.py # 图片管理 
 ├── ui/ # 用户界面 
 │ └── main_window.py # 主窗口 
 └── utils/ # 工具函数 
 └── logger.py # 日志配置
```

## 开发进度
- [x] 项目结构和需求分析
- [x] 图片导入功能实现
- [x] 图片导出功能实现
- [x] 文本水印功能开发
- [x] 实时预览功能实现
- [x] 配置管理模块实现
- [ ] 测试和优化

## 使用说明

### 拖拽导入功能
1. 从文件资源管理器中选择一张或多张图片文件
2. 直接拖拽到应用程序窗口或图片列表区域
3. 系统会自动识别支持的图片格式并导入
4. 拖拽时会有视觉反馈（蓝色虚线边框）

### 文件选择器导入
- 点击"导入单张"按钮选择单张图片
- 点击"导入多张"按钮选择多张图片
- 点击"导入文件夹"按钮选择整个文件夹

### 文本水印功能
1. **启用水印**：勾选"启用水印"复选框
2. **设置水印文本**：在文本框中输入水印文字
3. **选择位置**：从下拉菜单中选择水印位置
4. **字体设置**：
   - 选择字体类型
   - 调节字号大小
   - 启用粗体/斜体效果
5. **颜色设置**：
   - 点击颜色按钮打开颜色选择器
   - 选择预设颜色或自定义颜色
   - 实时预览颜色效果
6. **透明度调节**：使用滑块调节水印透明度
7. **特效选项**：根据需要启用阴影或描边效果

### 配置管理功能
1. **保存水印模板**：
   - 配置好水印设置后，在模板名称输入框中输入名称
   - 点击"保存模板"按钮保存当前设置
2. **加载水印模板**：
   - 从模板下拉列表中选择已保存的模板
   - 点击"加载模板"按钮应用模板设置
3. **删除水印模板**：
   - 从模板下拉列表中选择要删除的模板
   - 点击"删除模板"按钮确认删除
4. **默认模板管理**：
   - **设置默认模板**：选择模板后点击"设为默认模板"按钮
   - **应用默认模板**：点击"应用默认模板"按钮快速应用默认设置
5. **自动保存和加载**：
   - 程序关闭时自动保存当前水印设置到配置文件
   - 程序启动时自动加载上次设置或默认模板

### 实时预览功能
- **即时反馈**：所有水印设置变更会立即在预览窗口中显示效果
- **多图片预览**：点击左侧图片列表可切换预览不同图片
- **交互体验**：无需手动刷新，设置变更自动更新预览
- **效果验证**：在导出前可完整预览最终水印效果

### 图片导出功能
1. **单张图片导出**：
   - 在左侧列表中选择要导出的图片
   - 在右侧导出设置区域配置导出选项
   - 点击"导出当前图片"按钮
   - 选择输出目录，确认导出

2. **批量图片导出**：
   - 确保已导入多张图片
   - 在右侧导出设置区域配置导出选项
   - 点击"导出所有图片"按钮
   - 选择输出目录，系统将批量处理所有图片

3. **导出选项说明**：
   - **输出格式**：JPEG（有损压缩）或PNG（无损压缩，支持透明通道）
   - **文件命名**：前缀 + 原文件名 + 后缀 + 扩展名
   - **JPEG质量**：数值越高，图片质量越好，文件越大
   - **图片缩放**：
     - 宽度缩放：按指定宽度缩放，高度按比例调整
     - 高度缩放：按指定高度缩放，宽度按比例调整
     - 百分比缩放：按百分比缩放图片尺寸（1%-500%）

## 技术特性
- **用户友好界面**：直观的拖拽操作和清晰的预览显示
- **文本水印功能**：完整的文本水印设置，支持自定义颜色、字体、位置等
- **配置管理**：完善的水印模板管理，支持保存、加载、删除和默认模板设置
- **实时预览**：所有水印设置变更即时反馈，提升用户体验
- **错误处理**：完善的异常处理和用户提示
- **性能优化**：批量处理时显示进度条，避免界面卡顿
- **格式兼容**：支持多种常见图片格式
- **尺寸调整**：灵活的图片缩放选项，保持图片质量