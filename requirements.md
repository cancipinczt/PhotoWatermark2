# PhotoWatermark2 需求规格说明

## 项目概述

PhotoWatermark2 是一个基于Python的Windows桌面应用程序，用于为图片添加水印。该应用提供直观的图形界面，支持文本和图片水印，具备批量处理能力，并包含丰富的自定义选项。

## 功能需求

### 1. 文件处理模块

#### 1.1 图片导入功能
- **单张图片导入**
  - 支持拖拽方式导入单张图片
  - 支持文件选择器导入单张图片
  - 在界面上显示导入图片的缩略图和文件名

- **批量导入功能**
  - 支持一次性选择多张图片
  - 支持导入整个文件夹
  - 显示已导入图片列表（缩略图+文件名）
  - 支持从列表中删除已导入的图片

#### 1.2 图片格式支持
- **输入格式**
  - 必须支持：JPEG, PNG（含透明通道）
  - 建议支持：BMP, TIFF

- **输出格式**
  - 用户可选择输出为 JPEG 或 PNG
  - PNG格式需保持透明通道

#### 1.3 图片导出功能
- **输出路径设置**
  - 用户可指定输出文件夹
  - 默认禁止导出到原文件夹（防止覆盖原图）
  - 提供文件夹选择对话框

- **文件命名规则**
  - 保留原文件名
  - 添加自定义前缀（如 `wm_`）
  - 添加自定义后缀（如 `_watermarked`）

- **高级导出选项**
  - JPEG质量调节滑块（0-100）
  - 图片尺寸调整功能
    - 按宽度缩放
    - 按高度缩放
    - 按百分比缩放

### 2. 水印类型模块

#### 2.1 文本水印
- **基础功能**
  - 用户可自定义输入任意文本内容
  - 透明度调节（0-100%）

- **高级功能**
  - 字体选择：系统已安装字体
  - 字号设置
  - 粗体/斜体样式
  - 颜色选择（调色板）
  - 阴影效果
  - 描边效果

#### 2.2 图片水印（高级功能）
- **水印图片导入**
  - 从本地选择图片作为水印
  - 支持带透明通道的PNG图片

- **水印调整**
  - 按比例缩放水印图片
  - 自由调整水印大小
  - 透明度调节（0-100%）

### 3. 水印布局与样式模块

#### 3.1 实时预览
- 主预览窗口实时显示水印效果
- 点击图片列表可切换预览不同图片
- 所有水印调整即时反映在预览中

#### 3.2 水印位置
- **预设位置**
  - 九宫格布局：四角 + 正中心
  - 一键放置功能

- **手动调整**
  - 鼠标拖拽水印到任意位置
  - 精确位置控制

#### 3.3 旋转功能（高级）
- 旋转滑块或输入框
- 支持任意角度旋转（0-360度）

### 4. 配置管理模块

#### 4.1 水印模板
- **模板保存**
  - 保存当前所有水印设置参数
  - 包括：内容、字体、颜色、位置、大小、透明度等

- **模板管理**
  - 加载已保存的模板
  - 删除不需要的模板
  - 设置默认模板

- **模板自动加载**
  - 程序启动时，自动加载上一次关闭时的设置（如果没有设置默认模板）或默认模板。

## 非功能需求

### 5. 性能需求
- **响应时间**
  - 图片加载时间 < 2秒（单张）
  - 水印预览刷新时间 < 0.5秒
  - 批量处理时显示进度条

- **内存使用**
  - 单张图片处理内存占用 < 100MB
  - 支持大尺寸图片处理（最大支持10MB单张图片）

### 6. 用户体验需求
- **界面设计**
  - 直观易用的图形界面
  - 合理的布局和控件分组
  - 清晰的视觉反馈

- **操作流程**
  - 简化的操作步骤
  - 合理的默认设置
  - 完善的错误提示

### 7. 兼容性需求
- **操作系统**
  - Windows 10/11（64位）
  - 支持高DPI显示

- **Python环境**
  - Python 3.8+
  - 依赖库兼容性保证

## 技术实现要求

### 8. 开发技术要求
- **编程语言**: Python 3.8+
- **GUI框架**: PyQt5
- **图像处理**: Pillow (PIL) 库
- **打包工具**: PyInstaller

### 9. 代码质量要求
- **代码规范**: 遵循PEP 8规范
- **注释要求**: 关键函数和类需要详细注释
- **错误处理**: 完善的异常处理机制
- **日志记录**: 关键操作日志记录

### 10. 部署要求
- **打包发布**
  - 生成独立的Windows可执行文件
  - 包含所有依赖库
  - 支持一键安装/运行

- **GitHub发布**
  - 详细的提交记录
  - 清晰的版本管理
  - 提供可直接下载的release文件

## 优先级划分

### 核心功能（必须实现）
1. 单张图片导入和导出
2. JPEG/PNG格式支持
3. 文本水印基础功能
4. 九宫格位置布局
5. 实时预览功能
6. 基本的配置保存

### 重要功能（建议实现）
1. 批量图片处理
2. 文件命名规则
3. 字体和颜色选择
4. 透明度调节
5. 模板管理功能

### 高级功能（可选实现）
1. 图片水印功能
2. 阴影和描边效果
3. 图片旋转功能
4. JPEG质量调节
5. 图片尺寸缩放

## 验收标准

### 功能验收
- 所有核心功能正常工作
- 用户界面响应流畅
- 处理结果符合预期
- 错误处理机制完善

### 性能验收
- 处理速度满足要求
- 内存使用合理
- 大文件处理稳定

### 兼容性验收
- 在目标Windows系统上正常运行
- 支持常见图片格式
- 生成的可执行文件可直接运行

## 后续扩展考虑

### 可能的扩展功能
1. 批量重命名功能
2. 水印批量应用模板
3. 更多图片滤镜效果
4. 云端模板同步
5. 多语言支持

---

*本文档将作为PhotoWatermark2项目开发的指导文件，后续开发需严格遵循此规格说明。*